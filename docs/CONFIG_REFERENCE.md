# 配置字段说明（.env）

本文件按模块解释每个字段的作用、建议值与注意事项。

## 1. 必填配置

- `API_BASE_URL`：API 入口。默认 `https://api.predict.fun`。
- `API_KEY`：必填。所有接口都需要。
- `PRIVATE_KEY`：必填。用于签名交易。
- `JWT_TOKEN`：实盘必填。用于私有接口。
- `RPC_URL`：可选。链上签名/审批更稳定。

## 2. 做市商参数

- `SPREAD`：基础价差（如 0.02 = 2%）。
- `MIN_SPREAD` / `MAX_SPREAD`：价差上下限。
- `USE_VALUE_SIGNAL`：是否用价值信号调整挂单。
- `VALUE_SIGNAL_WEIGHT`：价值信号权重（0-1）。
- `VALUE_CONFIDENCE_MIN`：价值信号最低置信度。
- `ORDER_SIZE`：每笔挂单金额（USDT）。
- `MAX_SINGLE_ORDER_VALUE`：单笔最大金额。
- `MAX_POSITION`：单市场最大持仓金额。
- `INVENTORY_SKEW_FACTOR`：库存偏置强度。
- `CANCEL_THRESHOLD`：价格偏离阈值自动撤单。
- `REPRICE_THRESHOLD`：重新报价阈值。
- `MIN_ORDER_INTERVAL_MS`：同市场下单最小间隔。
- `MAX_ORDERS_PER_MARKET`：单市场最大挂单数。
- `MAX_DAILY_LOSS`：日内亏损熔断。

### 做市自适应参数（新增）

- `MM_ACCOUNT_EQUITY_USD`：账户净资产估算（用于动态风控）。
- `MM_MAX_POSITION_PCT`：单市场最大持仓占净资产比例（如 0.05=5%）。
- `MM_ORDER_SIZE_PCT`：单笔挂单金额占净资产比例。
- `MM_MAX_SINGLE_ORDER_PCT`：单笔上限占净资产比例。
- `MM_MAX_DAILY_LOSS_PCT`：日内亏损熔断占净资产比例。
- `MM_ADAPTIVE_PARAMS`：开启自适应参数（默认 true）。
- `MM_SPREAD_VOL_WEIGHT`：波动对价差放大的权重。
- `MM_SPREAD_LIQ_WEIGHT`：流动性不足对价差放大的权重。
- `MM_BOOK_SPREAD_WEIGHT`：盘口原生价差权重。
- `MM_VOL_EMA_ALPHA`：波动 EMA 系数。
- `MM_DEPTH_EMA_ALPHA`：深度 EMA 系数。
- `MM_DEPTH_LEVELS`：深度统计层数。
- `MM_MIN_TOP_DEPTH_SHARES`：最小顶层深度份额。
- `MM_MIN_TOP_DEPTH_USD`：最小顶层深度金额。
- `MM_DEPTH_DROP_RATIO`：顶层深度快速下滑阈值（如 0.5 表示下降 50% 触发）。
- `MM_DEPTH_REF_SHARES`：深度参考值，用于流动性惩罚。
- `MM_INVENTORY_SKEW_VOL_WEIGHT`：波动对库存偏置的权重。
- `MM_INVENTORY_SKEW_DEPTH_WEIGHT`：流动性对库存偏置的权重。
- `MM_ICEBERG_ENABLED`：启用冰山挂单模式（分块下单）。
- `MM_ICEBERG_RATIO`：每次下单使用目标份额的比例。
- `MM_ICEBERG_MAX_CHUNK_SHARES`：冰山单最大份额。
- `MM_ADAPTIVE_PROFILE`：自适应档位（AUTO / CALM / NORMAL / VOLATILE）。
- `MM_VOLATILITY_CALM_BPS`：低波动阈值（bps）。
- `MM_VOLATILITY_VOLATILE_BPS`：高波动阈值（bps）。
- `MM_INTERVAL_VOLATILITY_BPS`：高波动触发延长下单间隔的阈值。
- `MM_INTERVAL_VOL_MULTIPLIER`：高波动时下单间隔倍数。
- `MM_PROFILE_LIQUIDITY_LOW`：流动性低档位阈值（相对 `MM_DEPTH_REF_SHARES`）。
- `MM_PROFILE_LIQUIDITY_HIGH`：流动性高档位阈值（相对 `MM_DEPTH_REF_SHARES`）。
- `MM_PROFILE_SPREAD_MIN_CALM`：低波动档位最小价差。
- `MM_PROFILE_SPREAD_MAX_CALM`：低波动档位最大价差。
- `MM_PROFILE_SPREAD_MIN_VOLATILE`：高波动档位最小价差。
- `MM_PROFILE_SPREAD_MAX_VOLATILE`：高波动档位最大价差。
- `MM_ICEBERG_REQUOTE_MS`：冰山挂单重挂间隔（毫秒）。
- `MM_ORDER_REFRESH_MS`：挂单超过该时间自动撤单重挂。
- `MM_ORDER_DEPTH_USAGE`：单笔挂单不超过顶层深度的比例。
- `MM_INVENTORY_SPREAD_WEIGHT`：库存偏置导致价差扩大的权重。
- `MM_REPRICE_VOL_MULTIPLIER`：波动越大，重报价阈值越敏感。
- `MM_CANCEL_VOL_MULTIPLIER`：波动越大，撤单阈值越敏感。
- `MM_NEAR_TOUCH_VOL_MULTIPLIER`：波动越大，近成交撤单更早触发。
- `MM_ANTI_FILL_VOL_MULTIPLIER`：波动越大，防吃单撤单更早触发。
- `MM_COOLDOWN_VOL_MULTIPLIER`：波动越大，撤单后的冷却时间越长。
- `MM_IMBALANCE_LEVELS`：盘口不平衡计算层数。
- `MM_IMBALANCE_WEIGHT`：盘口不平衡对报价的影响权重。
- `MM_IMBALANCE_MAX_SKEW`：盘口不平衡最大偏移幅度。
- `MM_IMBALANCE_SPREAD_WEIGHT`：盘口不平衡导致价差扩张的权重。
- `MM_DEPTH_TREND_DROP_RATIO`：深度趋势快速下滑阈值（相对 EMA）。
- `MM_ICEBERG_REQUOTE_VOL_MULTIPLIER`：波动越大，冰山重挂间隔越长。
- `MM_ICEBERG_REQUOTE_DEPTH_MULTIPLIER`：深度下降时，冰山重挂间隔越长。
- `MM_PROFILE_HOLD_MS`：做市档位最小保持时间，避免频繁抖动。
- `MM_PROFILE_VOL_HYSTERESIS_BPS`：波动阈值回切缓冲（防止频繁切换）。
- `MM_ICEBERG_FILL_PENALTY`：被动成交后冰山缩小比例。
- `MM_ICEBERG_PENALTY_DECAY_MS`：冰山惩罚恢复时间（毫秒）。

## 3. 做市商防吃单/对冲

- `ANTI_FILL_BPS`：靠近吃单时撤单阈值。
- `NEAR_TOUCH_BPS`：提前撤单阈值。
- `COOLDOWN_AFTER_CANCEL_MS`：撤单后冷却。
- `VOLATILITY_PAUSE_BPS`：波动过大暂停。
- `VOLATILITY_LOOKBACK_MS`：波动检测窗口。
- `PAUSE_AFTER_VOLATILITY_MS`：暂停时长。
- `HEDGE_ON_FILL`：成交后自动对冲。
- `HEDGE_TRIGGER_SHARES`：触发对冲最小成交。
- `HEDGE_MODE`：`FLATTEN` 或 `CROSS`。
- `HEDGE_MAX_SLIPPAGE_BPS`：对冲最大滑点。

## 4. 套利总控

- `ENABLE_TRADING`：是否实盘下单。
- `AUTO_CONFIRM`：无人值守自动确认。
- `ARB_AUTO_EXECUTE`：开启自动执行套利。
- `ARB_AUTO_EXECUTE_VALUE`：价值错配自动执行（慎重）。
- `ARB_EXECUTE_TOP_N`：每轮执行 Top N 机会。
- `ARB_EXECUTION_COOLDOWN_MS`：同一机会冷却时间。
- `ARB_SCAN_INTERVAL_MS`：扫描频率。
- `ARB_MAX_MARKETS`：扫描市场数上限。
- `ARB_ORDERBOOK_CONCURRENCY`：并发拉取 orderbook。
- `ARB_MARKETS_CACHE_MS`：市场列表缓存。
- `ARB_WS_MAX_AGE_MS`：WS 数据最大允许延迟。

## 5. 自动执行熔断

- `ARB_MAX_ERRORS`：错误次数阈值。
- `ARB_ERROR_WINDOW_MS`：统计窗口。
- `ARB_PAUSE_ON_ERROR_MS`：暂停时长。
- `ARB_WS_HEALTH_LOG_MS`：WS 健康日志间隔，0=关闭。

## 6. 站内套利

- `CROSS_PLATFORM_MIN_PROFIT`：最低利润阈值（默认 0.01）。

## 7. 多结果套利

- `MULTI_OUTCOME_ENABLED`：启用。
- `MULTI_OUTCOME_MIN_OUTCOMES`：最少结果数。
- `MULTI_OUTCOME_MAX_SHARES`：最大下单份额。

## 8. 依赖套利

- `DEPENDENCY_ARB_ENABLED`：启用。
- `DEPENDENCY_CONSTRAINTS_PATH`：约束文件路径。
- `DEPENDENCY_PYTHON_PATH`：Python 路径。
- `DEPENDENCY_PYTHON_SCRIPT`：OR-Tools 脚本。
- `DEPENDENCY_MIN_PROFIT`：最低利润阈值。
- `DEPENDENCY_MAX_LEGS`：最大腿数。
- `DEPENDENCY_MAX_NOTIONAL`：最大资金。
- `DEPENDENCY_MIN_DEPTH`：最小深度。
- `DEPENDENCY_FEE_BPS`：默认手续费。
- `DEPENDENCY_FEE_CURVE_RATE`：可选手续费曲线系数（0 表示关闭曲线）。
- `DEPENDENCY_FEE_CURVE_EXPONENT`：可选手续费曲线指数（0 表示关闭曲线）。
- `DEPENDENCY_SLIPPAGE_BPS`：滑点。
- `DEPENDENCY_MAX_ITER`：迭代次数。
- `DEPENDENCY_ORACLE_TIMEOUT_SEC`：IP 超时。
- `DEPENDENCY_TIMEOUT_MS`：总超时。
- `DEPENDENCY_ALLOW_SELLS`：允许卖空。

## 9. 跨平台套利

- `CROSS_PLATFORM_ENABLED`：启用跨平台检测。
- `CROSS_PLATFORM_AUTO_EXECUTE`：自动执行。
- `CROSS_PLATFORM_REQUIRE_CONFIRM`：是否需要确认。
- `CROSS_PLATFORM_MAX_MATCHES`：最大匹配数。
- `CROSS_PLATFORM_TRANSFER_COST`：跨平台转账成本。
- `CROSS_PLATFORM_SLIPPAGE_BPS`：最大滑点。
- `CROSS_PLATFORM_MAX_SHARES`：跨平台 VWAP 估算的最大份额。
- `CROSS_PLATFORM_DEPTH_LEVELS`：跨平台订单簿深度层级数。
- `CROSS_PLATFORM_EXECUTION_VWAP_CHECK`：跨平台执行前 VWAP 预检（更稳健）。
- `CROSS_PLATFORM_PRICE_DRIFT_BPS`：预检时允许的最优价漂移上限（bps）。
- `CROSS_PLATFORM_ADAPTIVE_SIZE`：执行前根据订单簿深度自动缩小下单份额。
- `CROSS_PLATFORM_MIN_DEPTH_SHARES`：深度不足时的最小下单份额门槛。
- `CROSS_PLATFORM_VOLATILITY_BPS`：短时间内价格波动阈值（bps），超出则跳过。
- `CROSS_PLATFORM_VOLATILITY_LOOKBACK_MS`：波动检测的回看窗口（毫秒）。
- `CROSS_PLATFORM_TOKEN_MAX_FAILURES`：单 token 失败次数阈值。
- `CROSS_PLATFORM_TOKEN_FAILURE_WINDOW_MS`：单 token 失败统计窗口。
- `CROSS_PLATFORM_TOKEN_COOLDOWN_MS`：单 token 冷却时间。
- `CROSS_PLATFORM_METRICS_LOG_MS`：执行指标日志间隔（毫秒，0 关闭）。
- `CROSS_PLATFORM_DEPTH_USAGE`：最多使用订单簿深度的比例（默认 0.5）。
- `CROSS_PLATFORM_MAX_NOTIONAL`：跨平台执行最大名义金额上限。
- `CROSS_PLATFORM_RECHECK_MS`：预检接近阈值时的二次确认间隔（毫秒）。
- `CROSS_PLATFORM_RECHECK_DEVIATION_BPS`：VWAP 偏离超过该阈值触发二次确认。
- `CROSS_PLATFORM_RECHECK_DRIFT_BPS`：最优价漂移超过该阈值触发二次确认。
- `CROSS_PLATFORM_STABILITY_SAMPLES`：执行前稳定性采样次数（>1 启用）。
- `CROSS_PLATFORM_STABILITY_INTERVAL_MS`：稳定性采样间隔（毫秒）。
- `CROSS_PLATFORM_STABILITY_BPS`：稳定性漂移阈值（bps）。
- `CROSS_PLATFORM_POST_TRADE_DRIFT_BPS`：成交后盘口漂移阈值（超出则记录降级）。
- `CROSS_PLATFORM_AUTO_TUNE`：执行质量自动调参开关。
- `CROSS_PLATFORM_AUTO_TUNE_MIN_FACTOR`：自动调参最小系数。
- `CROSS_PLATFORM_AUTO_TUNE_MAX_FACTOR`：自动调参最大系数。
- `CROSS_PLATFORM_AUTO_TUNE_UP`：成功时提升系数的幅度。
- `CROSS_PLATFORM_AUTO_TUNE_DOWN`：失败时下降系数的幅度。
- `CROSS_PLATFORM_TOKEN_MIN_SCORE`：token 最低评分阈值（低于则跳过）。
- `CROSS_PLATFORM_TOKEN_SCORE_ON_SUCCESS`：成功时 token 加分。
- `CROSS_PLATFORM_TOKEN_SCORE_ON_FAILURE`：失败时 token 扣分。
- `CROSS_PLATFORM_TOKEN_SCORE_ON_VOLATILITY`：波动异常时 token 扣分。
- `CROSS_PLATFORM_TOKEN_SCORE_ON_POST_TRADE`：成交后漂移异常时 token 扣分。
- `CROSS_PLATFORM_PLATFORM_MIN_SCORE`：平台最低评分阈值（低于则跳过）。
- `CROSS_PLATFORM_PLATFORM_SCORE_ON_SUCCESS`：成功时平台加分。
- `CROSS_PLATFORM_PLATFORM_SCORE_ON_FAILURE`：失败时平台扣分。
- `CROSS_PLATFORM_PLATFORM_SCORE_ON_VOLATILITY`：波动异常时平台扣分。
- `CROSS_PLATFORM_PLATFORM_SCORE_ON_POST_TRADE`：成交后漂移异常平台扣分。
- `CROSS_PLATFORM_PLATFORM_SCORE_ON_SPREAD`：腿间漂移差过大时平台扣分。
- `CROSS_PLATFORM_LEG_DRIFT_SPREAD_BPS`：腿间漂移差阈值（bps）。
- `CROSS_PLATFORM_ALLOWLIST_TOKENS`：token 白名单（逗号分隔）。
- `CROSS_PLATFORM_BLOCKLIST_TOKENS`：token 黑名单（逗号分隔）。
- `CROSS_PLATFORM_ALLOWLIST_PLATFORMS`：平台白名单（Predict/Polymarket/Opinion）。
- `CROSS_PLATFORM_BLOCKLIST_PLATFORMS`：平台黑名单。
- `CROSS_PLATFORM_CHUNK_MAX_SHARES`：单次执行最大份额（>0 启用分块）。
- `CROSS_PLATFORM_CHUNK_MAX_NOTIONAL`：单次执行最大名义金额（>0 启用分块）。
- `CROSS_PLATFORM_CHUNK_DELAY_MS`：分块执行间隔（毫秒）。
- `CROSS_PLATFORM_CHUNK_AUTO_TUNE`：分块大小自动调节开关。
- `CROSS_PLATFORM_CHUNK_FACTOR_MIN`：分块自适应最小系数。
- `CROSS_PLATFORM_CHUNK_FACTOR_MAX`：分块自适应最大系数。
- `CROSS_PLATFORM_CHUNK_FACTOR_UP`：执行成功时分块放大幅度。
- `CROSS_PLATFORM_CHUNK_FACTOR_DOWN`：执行失败时分块缩小幅度。
- `CROSS_PLATFORM_CHUNK_DELAY_AUTO_TUNE`：分块延迟自动调节开关。
- `CROSS_PLATFORM_CHUNK_DELAY_MIN_MS`：分块延迟最小值。
- `CROSS_PLATFORM_CHUNK_DELAY_MAX_MS`：分块延迟最大值。
- `CROSS_PLATFORM_CHUNK_DELAY_UP_MS`：失败时延迟增加幅度。
- `CROSS_PLATFORM_CHUNK_DELAY_DOWN_MS`：成功时延迟减少幅度。
- `CROSS_PLATFORM_PLATFORM_MAX_FAILURES`：平台失败次数阈值。
- `CROSS_PLATFORM_PLATFORM_FAILURE_WINDOW_MS`：平台失败统计窗口。
- `CROSS_PLATFORM_PLATFORM_COOLDOWN_MS`：平台冷却时间。
- `CROSS_PLATFORM_AUTO_BLOCKLIST`：自动黑名单开关。
- `CROSS_PLATFORM_AUTO_BLOCKLIST_COOLDOWN_MS`：自动黑名单冷却时间。
- `CROSS_PLATFORM_AUTO_BLOCKLIST_SCORE`：触发黑名单的评分阈值。
- `CROSS_PLATFORM_GLOBAL_COOLDOWN_MS`：全局冷却时间（质量过低时触发）。
- `CROSS_PLATFORM_GLOBAL_MIN_QUALITY`：触发全局冷却的最低质量系数。
- `CROSS_PLATFORM_STATE_PATH`：跨平台执行状态持久化路径。
- `CROSS_PLATFORM_METRICS_PATH`：执行指标输出路径（JSON）。
- `CROSS_PLATFORM_METRICS_FLUSH_MS`：指标落盘间隔（毫秒）。
- `CROSS_PLATFORM_ORDER_TYPE`：跨平台下单类型（FOK / FAK / GTC / GTD）。
- `CROSS_PLATFORM_BATCH_ORDERS`：Polymarket 批量下单（仅 Polymarket，最多 15）。
- `CROSS_PLATFORM_BATCH_MAX`：批量下单单次最大腿数（默认 15）。
- `CROSS_PLATFORM_USE_FOK`：Polymarket 使用 FOK 下单（更安全）。
- `CROSS_PLATFORM_PARALLEL_SUBMIT`：跨平台并行下单（降低腿间风险）。
- `CROSS_PLATFORM_LIMIT_ORDERS`：跨平台优先使用限价单。
- `CROSS_PLATFORM_CANCEL_OPEN_MS`：Predict 订单未成交时的自动撤单时间。
- `CROSS_PLATFORM_POST_FILL_CHECK`：执行后检查是否仍有未成交订单。
- `CROSS_PLATFORM_FILL_CHECK_MS`：执行后等待多久再检查未成交订单。
- `CROSS_PLATFORM_HEDGE_ON_FAILURE`：跨平台执行失败时尝试对冲。
- `CROSS_PLATFORM_HEDGE_PREDICT_ONLY`：仅在 Predict 侧进行对冲。
- `CROSS_PLATFORM_HEDGE_SLIPPAGE_BPS`：对冲时允许的滑点上限。
- `CROSS_PLATFORM_MAX_RETRIES`：跨平台执行失败时的重试次数。
- `CROSS_PLATFORM_RETRY_DELAY_MS`：重试间隔（毫秒）。
- `CROSS_PLATFORM_CIRCUIT_MAX_FAILURES`：熔断触发的最大失败次数。
- `CROSS_PLATFORM_CIRCUIT_WINDOW_MS`：失败统计窗口。
- `CROSS_PLATFORM_CIRCUIT_COOLDOWN_MS`：熔断冷却时间。
- `CROSS_PLATFORM_RETRY_SIZE_FACTOR`：重试时缩小份额比例。
- `CROSS_PLATFORM_RETRY_AGGRESSIVE_BPS`：重试时价格更激进的幅度（bps）。
- `CROSS_PLATFORM_MAPPING_PATH`：映射表路径。
- `CROSS_PLATFORM_USE_MAPPING`：是否强制映射。

## 10. Alerts

- `ALERT_WEBHOOK_URL`：告警 Webhook。
- `ALERT_MIN_INTERVAL_MS`：最小间隔。

## 11. Polymarket

- `POLYMARKET_GAMMA_URL`：市场列表 API。
- `POLYMARKET_CLOB_URL`：订单簿 API。
- `POLYMARKET_MAX_MARKETS`：扫描上限。
- `POLYMARKET_FEE_BPS`：手续费估算。
- `POLYMARKET_FEE_RATE_URL`：CLOB 手续费查询接口（fee-rate）。
- `POLYMARKET_FEE_RATE_CACHE_MS`：fee-rate 缓存时间。
- `POLYMARKET_FEE_CURVE_RATE`：手续费曲线系数（默认 0.25）。
- `POLYMARKET_FEE_CURVE_EXPONENT`：手续费曲线指数（默认 2）。
- `POLYMARKET_WS_ENABLED`：WS 开关。
- `POLYMARKET_WS_URL`：WS 地址。
- `POLYMARKET_WS_CUSTOM_FEATURE`：特殊订阅模式。
- `POLYMARKET_WS_INITIAL_DUMP`：连接后是否请求初始快照。
- `POLYMARKET_WS_STALE_MS`：WS 无消息的最大容忍时长，超时重连。
- `POLYMARKET_WS_RESET_ON_RECONNECT`：重连后清空缓存，触发 REST 回补。
- `POLYMARKET_CACHE_TTL_MS`：市场列表缓存。
- `POLYMARKET_PRIVATE_KEY`：签名私钥。
- `POLYMARKET_API_KEY/SECRET/PASSPHRASE`：API 凭证。
- `POLYMARKET_CHAIN_ID`：链 ID。
- `POLYMARKET_AUTO_DERIVE_API_KEY`：自动派生。

## 12. Predict WS

- `PREDICT_WS_ENABLED`：WS 开关。
- `PREDICT_WS_URL`：WS 地址。
- `PREDICT_WS_API_KEY`：WS Key。
- `PREDICT_WS_TOPIC_KEY`：订阅维度。
- `PREDICT_WS_STALE_MS`：WS 无消息的最大容忍时长，超时重连。
- `PREDICT_WS_RESET_ON_RECONNECT`：重连后清空缓存，触发 REST 回补。

## 13. Opinion

- `OPINION_OPENAPI_URL`：OpenAPI。
- `OPINION_API_KEY`：API Key。
- `OPINION_MAX_MARKETS`：最大市场。
- `OPINION_FEE_BPS`：手续费。
- `OPINION_PYTHON_PATH`：Python 路径。
- `OPINION_PYTHON_SCRIPT`：下单脚本。
- `OPINION_PRIVATE_KEY`：私钥。
- `OPINION_CHAIN_ID`：链 ID。
- `OPINION_HOST`：Host。
- `OPINION_WS_ENABLED`：WS 开关。
- `OPINION_WS_URL`：WS 地址。
- `OPINION_WS_HEARTBEAT_MS`：心跳间隔。
- `OPINION_WS_STALE_MS`：WS 无消息的最大容忍时长，超时重连。
- `OPINION_WS_RESET_ON_RECONNECT`：重连后清空缓存，触发 REST 回补。

## 14. 其他

- `MARKET_TOKEN_IDS`：只交易指定 token（逗号分隔）。
- `REFRESH_INTERVAL`：做市商刷新频率。
